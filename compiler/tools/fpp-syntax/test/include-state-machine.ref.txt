def state machine
  ident M
  @ Action a1
  def action
    ident a1
  @ Action a2
  def action
    ident a2
  def state
    ident S1
    spec state entry
      action ident a1
      action ident a2
    spec state exit
      action ident a1
      action ident a2
    @ Initial transition
    spec initial
      action ident a1
      action ident a2
      target qual ident S3
    @ Choice C
    def choice
      ident C
      guard ident g1
      action ident a1
      action ident a2
      target qual ident S1
      action ident a2
      action ident a3
      target qual ident S2.S3
  def state
    ident S2
    def state
      ident S1
      spec state entry
        action ident a1
        action ident a2
      spec state exit
        action ident a1
        action ident a2
      @ Initial transition
      spec initial
        action ident a1
        action ident a2
        target qual ident S3
      @ Choice C
      def choice
        ident C
        guard ident g1
        action ident a1
        action ident a2
        target qual ident S1
        action ident a2
        action ident a3
        target qual ident S2.S3
